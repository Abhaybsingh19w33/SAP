Projection Entities define interfaces on the basis of existing CDS Entity. It is always based on exactly one existing CDS view entity and it projects a subset of its elements required for the business service.

Metadata Extensions are created to annotate entities at header level and at field level. These annotations drive the descriptions of fields, sequence of fields on application and whether the fields will be available in filter bar or not.

```
parent
^
|       composition (Parent Child relationship)
child

ZI_JP_TRAV_01 (root view entity) consumption view on table /dmo/travel
^
|
ZI_JP_BOOK_01 (view entity) on table /dmo/booking
    association to parent ZI_JP_TRAV_01

ZI_JP_TRAV_01 (root view entity) consumption view on table /dmo/travel (1)
|
|-> ZC_JP_TRAV_01 (root view entity) Projection Entity on ZI_JP_TRAV_01 (3)
|   |
|   |-> ZME_JP_TRAV_01 (annotate entity) Metadata Extension (5)
|   |
|   |-> ZC_JP_TRAV_01 Behaviour Definition created with the ZI_JP_BOOK_01
|   |
|   |-> ZSD_JP_TRAV_01 Service Definition Exposes ZC_JP_TRAV01, ZC_JP_BOOK_01
|       |
|       |-> ZSB_JP_TRAVEL_01 Service Binding
|
|-> ZI_JP_TRAV_01 Behaviour Definition
    |
    |-> ZI_JP_BOOK_01 Behaviour Definition created with the ZI_JP_BOOK_01


ZI_JP_BOOK_01 (view entity) on table /dmo/booking (2)
|
|-> ZC_JP_BOOK_01 (view entity) Projection Entity on ZI_JP_BOOK_01 (4)
    |
    |-> ZME_JP_BOOK_01 (annotate entity) Metadata Extension (6)
```

=> ZI_JP_TRAV_01 (root view entity) consumption view on table /dmo/travel
```
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Root Entity for Travel'
define root view entity ZI_JP_TRAV_01
as select from /dmo/travel as Travel
    composition [0..*] of ZI_JP_BOOK_01 as _Booking
    association [0..1] to /DMO/I_Agency as _Agency on $projection.AgencyId = _Agency.AgencyID
    association [0..1] to /DMO/I_Customer as _Customer on $projection.CustomerId = _Customer.CustomerID
    association [0..1] to I_Currency as _Currency on $projection.CurrencyCode = _Currency.Currency
{
    key Travel.travel_id as TravelId,
        Travel.agency_id as AgencyId,
        Travel.customer_id as CustomerId,
        Travel.begin_date as BeginDate,
        Travel.end_date as EndDate,
        @Semantics.amount.currencyCode: 'CurrencyCode'
        Travel.booking_fee as BookingFee,
        @Semantics.amount.currencyCode: 'CurrencyCode'
        Travel.total_price as TotalPrice,
        Travel.currency_code as CurrencyCode,
        Travel.description as Description,
        Travel.status as Status,
        Travel.lastchangedat as LastChangedAt,
        _Booking,
        _Agency,
        _Customer,
        _Currency
}
```

=> ZI_JP_BOOK_01 (view entity) on table /dmo/booking
```
@AbapCatalog.viewEnhancementCategory: [#NONE]
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Entity for Booking'
@Metadata.ignorePropagatedAnnotations: true
@ObjectModel.usageType:{
    serviceQuality: #X,
    sizeCategory: #S,
    dataClass: #MIXED
}
define view entity ZI_JP_BOOK_01 as 
select from /dmo/booking as Booking
    association to parent ZI_JP_TRAV_01 as _Travel
    on $projection.TravelID = _Travel.TravelId
    association [1..1] to /DMO/I_Customer as _Customer
    on $projection.CustomerID = _Customer.CustomerID
    association [1..1] to /DMO/I_Carrier as _Carrier
    on $projection.AirlineID = _Carrier.AirlineID
    association [1..1] to /DMO/I_Connection as _Connection
    on $projection.AirlineID = _Connection.AirlineID
    and $projection.ConnectionID = _Connection.ConnectionID
{
    key Booking.travel_id as TravelID,
    key Booking.booking_id as BookingID,
        Booking.booking_date as BookingDate,
        Booking.customer_id as CustomerID,
        Booking.carrier_id as AirlineID,
        Booking.connection_id as ConnectionID,
        Booking.flight_date as FlightDate,
        @Semantics.amount.currencyCode: 'CurrencyCode'
        Booking.flight_price as FlightPrice,
        Booking.currency_code as CurrencyCode,
        _Travel,
        _Customer,
        _Carrier,
        _Connection
}
```

=> ZC_JP_TRAV_01 (root view entity) Projection Entity on ZI_JP_TRAV_01

    define root view entity ZC_JP_TRAV_01
    as projection on ZI_JP_TRAV_01

This defines that the entity ZC_JP_TRAV_01 is a projection on entity ZI_JP_TRAV_01. As the base entity is a root entity, the projection entity also has to be a root entity.

    _Booking : redirected to composition child ZC_JP_BOOK_01,

This is a reference to the projection entity of the child i.e. booking.
```
@AbapCatalog.viewEnhancementCategory: [#NONE]
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Consumption View for Travel'
@Metadata.ignorePropagatedAnnotations: true
@Metadata.allowExtensions: true
@Search.searchable: true
@ObjectModel.usageType:{
    serviceQuality: #X,
    sizeCategory: #S,
    dataClass: #MIXED
}

@UI:{ headerInfo: {
    typeName: 'Travel',
    typeNamePlural: 'Travels',
    title: {
        type: #STANDARD,
        value: 'TravelID'
    }
} }
define root view entity ZC_JP_TRAV_01
  as projection on ZI_JP_TRAV_01
{

  key TravelId,

      @Consumption.valueHelpDefinition: [{

          entity: {
              name: '/DMO/I_Agency',
              element: 'AgencyID'
          }}]
      @ObjectModel.text.element: ['AgencyName']
      @Search.defaultSearchElement: true
      AgencyId,
      _Agency.Name        as AgencyName,

      @Consumption.valueHelpDefinition: [{

               entity: {
                   name: '/DMO/I_Customer',
                   element: 'CustomerID'
               }}]
      @ObjectModel.text.element: ['CustomerName']
      @Search.defaultSearchElement: true

      CustomerId,
      _Customer.FirstName as CustomerName,

      BeginDate, 
      EndDate,
      @Semantics.amount.currencyCode: 'CurrencyCode'
      BookingFee,
      @Semantics.amount.currencyCode: 'CurrencyCode'
      TotalPrice,

      @Consumption.valueHelpDefinition: [{

             entity: {
                 name: 'I_Currency',
                 element: 'Currency'
             }}]
      @Search.defaultSearchElement: true
      CurrencyCode,
      Description,
      Status,
      LastChangedAt,
      _Agency,
      _Booking : redirected to composition child ZC_JP_BOOK_01,
      _Currency,
      _Customer
}
```

=> ZC_JP_BOOK_01

This will be not a root view entity, because base is also not a root view entity.

    @Consumption.valueHelpDefinition: [{
        entity: {
            name: '/DMO/I_Flight',
            element: 'ConnectionID'
        },
        additionalBinding: [
            {localElement: 'FlightDate', element: 'FlightDate'},
            {localElement: 'AirlineID',element: 'AirlineID' },
            {localElement: 'FlightPrice',element: 'Price'},
            {localElement: 'CurrencyCode',element: 'CurrencyCode'}]
    }]
    ConnectionID,

Here, there is additional binding is specified which helps populate related fields from single value help. i.e. when connection id is selected from the value help, corresponding flight date, airline id, price and currency is also populated.

    _Travel : redirected to parent ZC_JP_TRAV_01
Similar to Travel entity, Booking entity also refers to the parent-child association by specifying the parent projection entity name.

```
@AbapCatalog.viewEnhancementCategory: [#NONE]
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Projection for Booking'
@Metadata.ignorePropagatedAnnotations: true
@Metadata.allowExtensions: true
@Search.searchable: true
@ObjectModel.usageType:{
    serviceQuality: #X,
    sizeCategory: #S,
    dataClass: #MIXED
}
define view entity ZC_JP_BOOK_01
  as projection on ZI_JP_BOOK_01
{
      //Z_I_BOOKING_U
      @Search.defaultSearchElement: true
  key TravelID,
      @Search.defaultSearchElement: true
  key BookingID,

      BookingDate,

      @Consumption.valueHelpDefinition: [{

          entity: {
              name: '/DMO/I_Customer',
              element: 'CustomerID'
          }}]
      @Search.defaultSearchElement: true
      @ObjectModel.text.element: ['CustomerName']
      CustomerID,
      _Customer.FirstName as CustomerName,

      @Consumption.valueHelpDefinition: [{

         entity: {
             name: '/DMO/I_Carrier',
             element: 'AirlineID'
         }}]
      @Search.defaultSearchElement: true
      @ObjectModel.text.element: ['AirlineName']

      AirlineID,
      _Carrier.Name       as AirlineName,

      @Consumption.valueHelpDefinition: [{
          entity: {
              name: '/DMO/I_Flight',
              element: 'ConnectionID'
          },
          additionalBinding: [
              {localElement: 'FlightDate', element: 'FlightDate'},
              {localElement: 'AirlineID',element: 'AirlineID' },
              {localElement: 'FlightPrice',element: 'Price'},
              {localElement: 'CurrencyCode',element: 'CurrencyCode'}]
      }]
      ConnectionID,

      @Consumption.valueHelpDefinition: [{
          entity: {
              name: '/DMO/I_Flight',
              element: 'FlightDate'
          },
          additionalBinding: [
              {localElement: 'ConnectionID', element: 'ConnectionID'},
              {localElement: 'AirlineID',element: 'AirlineID' },
              {localElement: 'FlightPrice',element: 'Price'},
              {localElement: 'CurrencyCode',element: 'CurrencyCode'}]
      }]
      FlightDate, 

      @Semantics.amount.currencyCode: 'CurrencyCode'
      FlightPrice,

      @Consumption.valueHelpDefinition: [{
         entity: {
             name: 'I_Currency',
             element: 'Currency'
         }}]

      CurrencyCode,
      _Carrier,
      _Connection,
      _Customer,
      _Travel : redirected to parent ZC_JP_TRAV_01
}
```

=> ZME_JP_TRAV_01

Here, lineItem specifies position in the list, identification specifies position in the detail page and identification specifies position in the filter bar.

We can also create additional buttons on the application using the type #FOR_ACTION.

    @UI.lineItem: [{position: 50,importance: #HIGH },
                             { type: #FOR_ACTION,
                               dataAction: 'set_status_booked' ,
                               label: 'Set to Booked'}]

```
@Metadata.layer: #CUSTOMER
@UI:{ headerInfo: {
    typeName: 'Travel',
    typeNamePlural: 'Travels',
    title: {
        type: #STANDARD,
        value: 'TravelID'
    }
} }
annotate entity ZC_JP_TRAV_01 with
{
    @UI.facet: [{
            id: 'Travel',
            purpose: #STANDARD,
            position: 10,
            label: 'Travel',
            type: #IDENTIFICATION_REFERENCE
        },{

            id: 'Booking',
            purpose: #STANDARD,
            position: 20,
            label: 'Booking',
            type: #LINEITEM_REFERENCE,
            targetElement: '_Booking'
        }]

    @UI:{ lineItem: [{position: 10,importance: #HIGH }],
            identification: [{position: 10 }],
            selectionField: [{position: 10 }] }
    TravelId;

    @UI:{ lineItem: [{position: 20,importance: #HIGH }],
            identification: [{position: 20 }],selectionField: [{position: 20 }] }
    AgencyId;

    @UI:{ lineItem: [{position: 30,importance: #HIGH }],
            identification: [{position: 30 }],selectionField: [{position: 30 }] }
    CustomerId;

    @UI:{ lineItem: [{position: 40,importance: #MEDIUM }],
        identification: [{position: 40 }] }

    BeginDate;

    @UI:{ lineItem: [{position: 41,importance: #MEDIUM }],
        identification: [{position: 41 }] }
    EndDate;

    @UI.identification: [{position: 42 }]
    BookingFee;

    @UI.identification: [{position: 43 }]
    TotalPrice;
    
    @UI.identification: [{position: 44 }]
    Description;
        
    @UI.lineItem: [{position: 50,importance: #HIGH },
                                { type: #FOR_ACTION,
                                dataAction: 'set_status_booked' ,
                                label: 'Set to Booked'}]
    Status;
}
```

=> ZME_JP_BOOK_01
```
@Metadata.layer: #CUSTOMER
@UI.headerInfo: {
    typeName: 'Booking',
    typeNamePlural: 'Bookings',
    title: {
        type: #STANDARD,
        label: 'Booking',
        value: 'BookingID'
    }
}
annotate entity ZC_JP_BOOK_01
    with 
{
    @UI.facet: [{id: 'Booking',
                    purpose: #STANDARD,
                    type: #IDENTIFICATION_REFERENCE,
                    label: 'Booking',
                    position: 10 }]
    @UI:{lineItem: [{  position: 10,importance: #HIGH }],
                    identification: [{position: 10 }]
    }
    BookingID;

    @UI:{lineItem: [{position: 20,importance: #HIGH }],
            identification: [{position: 20 }]
    }
    BookingDate;

    @UI:{lineItem: [{position: 30,importance: #HIGH }],
        identification: [{position: 30 }]
    }
    CustomerID;

    @UI:{lineItem: [{position: 40,importance: #HIGH }],
        identification: [{position: 40 }]
    }
    AirlineID;
    @UI:{lineItem: [{position: 50,importance: #HIGH }],
            identification: [{position: 50 }]
    }
    ConnectionID;

    @UI:{lineItem: [{position: 60,importance: #HIGH }],
        identification: [{position: 60 }]
    }

    FlightDate;

    @UI:{lineItem: [{position: 70,importance: #HIGH }],
        identification: [{position: 70 }]
    }
    FlightPrice;
}
```