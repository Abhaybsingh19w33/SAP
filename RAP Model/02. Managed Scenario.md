# ABAP RESTful Application Programming Model [2] – Managed Scenario

In this post, you will learn how to create a simple OData service using the RAP model. In this example, a single table is used to create a service.

![alt text](image-87.png)

```
TABLE ZYNY_RAP_BOOK_T (1)

CDS ENTITY ZYNY_RAP_BOOK (2)
|
|--> Metadata Extension(Annotate View) ZYNY_ME_RAP_BOOK (3)
|--> Behaviour Definition ZYNY_RAP_BOOK (4)
|--> Service Definition ZYNY_UI_RAP_BOOK (5)
     |
     |--> Service Binding ZYNY_UI_RAP_BOOK_SB (6)
```
We will create below application without having to write a single line of code on frontend i.e. UI5/Fiori.

![alt text](image-2.png)

##  Create a Table

Right click on the package and chose New > Other ABAP Repository Object

![alt text](image-3.png)

Chose Database Table, click Next

![alt text](image-4.png)

Enter Name and Description. Click Next.

![alt text](image-5.png)

Select a TR and Click Finish. If you do not have existing TR, create a new request.

![alt text](image-6.png)

Add the table fields after client field.

![alt text](image-7.png)

Completed the table as below.

```
@EndUserText.label : 'Travel Booking Table'
@AbapCatalog.enhancement.category : #NOT_EXTENSIBLE
@AbapCatalog.tableCategory : #TRANSPARENT
@AbapCatalog.deliveryClass : #A
@AbapCatalog.dataMaintenance : #RESTRICTED
define table zjp_rap_book {
  key client            : abap.clnt not null;
  key travel_id         : /dmo/travel_id not null;  
  key booking_id        : /dmo/booking_id;
  booking_date          : /dmo/booking_date;
  customer_id           : /dmo/customer_id;
  carrier_id            : /dmo/carrier_id;
  connection_id         : /dmo/connection_id;
  flight_date           : /dmo/flight_date;
  @Semantics.amount.currencyCode : 'zjp_rap_book.currency_code'
  flight_price          : /dmo/flight_price;
  currency_code         : /dmo/currency_code;
}
```

Activate the table.

At this point the table will not contain any data. So let us create a data provider class with below code.

```
CLASS zjp_book_data DEFINITION
  PUBLIC
  FINAL
  CREATE PUBLIC .

  PUBLIC SECTION.
    INTERFACES if_oo_adt_classrun.
ENDCLASS.

CLASS zjp_book_data IMPLEMENTATION.
  METHOD if_oo_adt_classrun~main.
    DELETE FROM zjp_rap_book.
    INSERT zjp_rap_book FROM (
        SELECT FROM /dmo/booking
        FIELDS
            travel_id         AS travel_id,
            booking_id        AS booking_id,
            booking_date      AS booking_date,
            customer_id       AS customer_id,
            carrier_id        AS carrier_id,
            connection_id     AS connection_id,
            flight_date       AS flight_date,
            flight_price      AS flight_price,
            currency_code     AS currency_code
         ORDER BY booking_id
         UP TO 10 ROWS ).

    COMMIT WORK.
    out->write( 'Booking data inserted'  ).
  ENDMETHOD.
ENDCLASS.
```

Execute the class to add the data.

![alt text](image-8.png)

The data is added to the table.

![alt text](image-9.png)

## Create Root CDS Entity

CDS Entity is create to expose the data through OData / Web API.

Right click on the package and chose New > Other ABAP Repository Object

![alt text](image-10.png)

Chose Data Definition. Click Next.

![alt text](image-11.png)

Enter Name and Description. Click Next.

![alt text](image-12.png)

Select TR. Click Next.

![alt text](image-13.png)

Chose template ‘Define Root View Entity‘. Click Finish.

![alt text](image-14.png)

Note that here you are creating a CDS Entity instead of a CDS view. As seen below, the Entity usually has compositions and associations, but for this post, we are not going to use any of those to keep things simple.

![alt text](image-15.png)

Complete the CDS Entity as below. You will see a warning as we have not created Authorizations for this entity, which can be ignored at the moment.

![alt text](image-16.png)

```
@AccessControl.authorizationCheck: #CHECK
@EndUserText.label: 'Root View for ZJP_RAP_BOOK Table'
@Metadata.allowExtensions: true
define root view entity zi_rap_book
  as select from zjp_rap_book
{
  key travel_id     as Travel_Id,
  key booking_id    as Booking_Id,
      booking_date  as Booking_Date,
      customer_id   as Customer_Id,
      carrier_id    as Carrier_Id,
      connection_id as Connection_Id,
      flight_date   as Flight_Date,
      flight_price  as Flight_Price,
      currency_code as Currency_Code
}
```
Activate. Execute as ABAP Application and check the data.

![alt text](image-17.png)

## Create a Metadata Extension

Metadata extension is created to annotate the CDS Entity and fields. We add description, screen position details etc., through these annotations.

Locate your CDS entity in the Package under node Core Data Services > Data Definitions. Right click on the Entity and Chose New Metadata Extension

![alt text](image-18.png)

Enter Name, and Description and chose Next.
![alt text](image-19.png)

Chose a TR and click Finish

![alt text](image-20.png)

You will get below template.

![alt text](image-21.png)

Complete the Metadata Extension as below.
![alt text](image-22.png)

The screenshot does not cover complete code, so use below code.
```
@Metadata.layer: #CORE
@UI: {
  headerInfo: { typeName: 'Booking',
                typeNamePlural: 'Bookings',
                title: { type: #STANDARD, label: 'Travel', value: 'Booking_ID' } }
              }
annotate view zi_rap_book
    with 
{
  @UI.facet: [ { id:              'Travel',
                 purpose:         #STANDARD,
                 type:            #IDENTIFICATION_REFERENCE,
                 label:           'Booking',
                 position:        10 } ]
 @UI: {  lineItem:       [ { position: 10 } ],
         identification: [ { position: 10 } ],
         selectionField: [ { position: 10 } ] }                
 travel_id;
 @UI: {  lineItem:       [ { position: 20 } ],
         identification: [ { position: 20 } ],
         selectionField: [ { position: 20 } ] }    
 booking_id;
 @UI: {  lineItem:       [ { position: 30 } ] ,
         identification: [ { position: 30 } ]}    
 booking_date;
 @UI: {  lineItem:       [ { position: 40 } ] ,
         identification: [ { position: 40 } ]}    
 customer_id;
 @UI: {  lineItem:       [ { position: 50 } ] ,
         identification: [ { position: 50 } ]}    
 carrier_id;
 @UI: {  lineItem:       [ { position: 60 } ] ,
         identification: [ { position: 60 } ]}    
 connection_id;
 @UI: {  lineItem:       [ { position: 70 } ] ,
         identification: [ { position: 70 } ]}    
 flight_date;
 @UI: {  lineItem:       [ { position: 80 } ] ,
         identification: [ { position: 80 } ]}    
 flight_price;
 @UI: {  lineItem:       [ { position: 90 } ] ,
         identification: [ { position: 90 } ]}    
 currency_code;
    
}
```
Activate.

##  Create a Behavior Definition

Behavior Definition is created to specify operation details that are possible for the Entity. This refers to CRUD operations. By default READ / QUERY operations are enabled.

Right click on CDS Entity and chose New Behavior Definition.
![alt text](image-23.png)

All details will be populated. Default implementation type is managed. We do not need to change it for this example. Click Next.

![alt text](image-24.png)

Chose a TR and click Finish.
![alt text](image-25.png)

Definition is created as below.
![alt text](image-26.png)

At this point, we do not need a class, so edit the definition as below. Note that you need to have same field names as table in CDS Entity. If the names are changed using AS, creating a class becomes mandatory.
![alt text](image-27.png)

```
managed; 

define behavior for zi_rap_book 
persistent table ZJP_RAP_BOOK
lock master
{
  create;
  update;
  delete;
}
```

Activate.

## Create a Service Definition

Service definition defines which CDS entities are exposed as part of the service.

Right click on the Root Entity and Chose New Service Definition.
![alt text](image-28.png)

Enter Name and Description. Click Next.
![alt text](image-29.png)

Chose TR and click Finish.
![alt text](image-30.png)

Service Definition is created. Just activate.
![alt text](image-31.png)

```
@EndUserText.label: 'Service Definition for Booking CDS view'
define service ZUI_RAP_BOOK {
  expose zi_rap_book;
}
```

## Create Service Binding

Service binding is created to Publish the service. Here, we chose the protocol like OData V2.

Right click on service definition and select New Service Binding.
![alt text](image-32.png)

Enter Name, Description and chose Binding Type as OData V2 – UI.
![alt text](image-33.png)

Chose TR and click Finish.
![alt text](image-34.png)

Service Binding is created. First activate the service binding.
![alt text](image-35.png)

Once activated, Publish button is enabled. Click to Publish the service.
![alt text](image-36.png)

This will take few minutes. The service will be published.
![alt text](image-37.png)

The service can be tested / previewed. Select the entity zi_rap_book and click on Preview.
![alt text](image-38.png)

Preview page appears similar to a Fiori Element Application.
![alt text](image-39.png)

Click Go to see the data.
![alt text](image-40.png)

This application preview can also be used to perform CRUD i.e. Create, Read, Update and Delete Operations.

## CREATE

Click Create to go to new entry screen.
![alt text](image-41.png)

## READ

Click on any entry to display it.
![alt text](image-42.png)

## UPDATE / DELETE

These options appear on the display screen in the top right corner.

Edit will open the record in edit mode where changes can be made and saved.
![alt text](image-43.png)


Delete will simply delete the record and return to main screen.
![alt text](image-44.png)
![alt text](image-45.png)


![alt text](image-88.png)

![alt text](image-89.png)

![alt text](image-90.png)

```
ZYNY_RAP_BOOK_T2 TABLE
|--> ZR_YNY_RAP_BOOK_T2000 Business Object Data Model CDS
|--> ZBP_R_YNY_RAP_BOOK_T2000 Business Object Behaviour implementation class
|--> ZC_YNY_RAP_BOOK_T2000 Service Proection Entity CDS
|--> ZBP_C_YNY_RAP_BOOK_T2000 Behaviour Implementation class 
|--> ZUI_YNY_RAP_BOOK_T2000_O4 Business Service Definition
|--> ZUI_YNY_RAP_BOOK_T2000_O4 Business Service Binding
```

```
ZYNY_RAP_BOOK_T2 TABLE

ZR_YNY_RAP_BOOK_T2 BO Data Model CDS
ZR_YNY_RAP_BOOK_T2 Behaviour Definition
ZBP_R_YNY_RAP_BOOK_T2 Behaviour Implementation class

ZC_YNY_RAP_BOOK_T2 BO Projection Data Model CDS
ZC_YNY_RAP_BOOK_T2 Behaviour definition for projection
ZBP_C_YNY_RAP_BOOK_T2 Behaviour implementation class

ZUI_YNY_RAP_BOOK_T2_O4 Service definition
ZUI_YNY_RAP_BOOK_T2_O4 Service Binding

```