REPORT Z.
TABLES SPFLI.
TYPES : BEGIN OF TY_SPFLI,  "User defined internal table type
          CARRID    TYPE SPFLI-CARRID,
          CONNID    TYPE SPFLI-CONNID,
          COUNTRYFR TYPE SPFLI-COUNTRYFR,
          CITYFROM  TYPE SPFLI-CITYFROM,
        END OF TY_SPFLI.

DATA : IT_SPFLI TYPE TABLE OF TY_SPFLI, "SPFLI internal table
       WA_SPFLI TYPE TY_SPFLI. "work area

DATA T_FCAT_SPFLI TYPE SLIS_T_FIELDCAT_ALV. "SPFLI field catalog
DATA W_FCAT_SPFLI TYPE SLIS_FIELDCAT_ALV.

TYPES : BEGIN OF TY_SFLIGHT,
          CARRID TYPE SFLIGHT-CARRID,
          CONNID TYPE SFLIGHT-CONNID,
          FLDATE TYPE SFLIGHT-FLDATE,
          PRICE  TYPE SFLIGHT-PRICE,
        END OF TY_SFLIGHT.

DATA : IT_SFLIGHT TYPE TABLE OF TY_SFLIGHT, "SFLIGHT internal table
       WA_SFLIGHT TYPE TY_SFLIGHT.

DATA T_FCAT_SFLIGHT TYPE SLIS_T_FIELDCAT_ALV. "SFLIGHT field catalog
DATA W_FCAT_SFLIGHT TYPE SLIS_FIELDCAT_ALV.

DATA S_EVENTS TYPE SLIS_T_EVENT.

DATA S_LAYOUT TYPE SLIS_LAYOUT_ALV.
S_LAYOUT-ZEBRA = 'X'.

SELECT-OPTIONS P_CARRID FOR SPFLI-CARRID. "CARRID type input

START-OF-SELECTION.
  PERFORM GET_DATA.
  PERFORM CREATE_FCAT_SPFLI.
  PERFORM CREATE_FCAT_SFLIGHT.
  PERFORM BLOCK_LIST_INIT.
  PERFORM BLOCK_LIST_APPEND_SPFLI.
  PERFORM BLOCK_LIST_APPEND_SFLIGHT.

  CALL FUNCTION 'REUSE_ALV_BLOCK_LIST_DISPLAY' . "display blocked list

FORM GET_DATA.
  SELECT CARRID
         CONNID
         COUNTRYFR
         CITYFROM
         FROM SPFLI "get SPFLI data
    INTO TABLE IT_SPFLI  WHERE CARRID IN P_CARRID.

  IF NOT IT_SPFLI IS INITIAL .
    SELECT  CARRID
            CONNID
            FLDATE
            PRICE FROM SFLIGHT INTO TABLE IT_SFLIGHT "get flight data
      FOR ALL ENTRIES IN IT_SPFLI WHERE CARRID = IT_SPFLI-CARRID.
  ENDIF.
ENDFORM.

FORM CREATE_FCAT_SPFLI.
  W_FCAT_SPFLI-COL_POS       = '1'. "coloum position
  W_FCAT_SPFLI-FIELDNAME     = 'CARRID'. "column name
  W_FCAT_SPFLI-REF_TABNAME   = 'SPFLI'.
  W_FCAT_SPFLI-REF_FIELDNAME = 'CARRID'. "reference field, it will show descriptions automatically
  APPEND W_FCAT_SPFLI TO T_FCAT_SPFLI.
  CLEAR W_FCAT_SPFLI.

  W_FCAT_SPFLI-COL_POS       = '2'.
  W_FCAT_SPFLI-FIELDNAME     = 'CONNID'.
  W_FCAT_SPFLI-REF_TABNAME   = 'SPFLI'.
  W_FCAT_SPFLI-REF_FIELDNAME = 'CONNID'.
  APPEND W_FCAT_SPFLI TO T_FCAT_SPFLI.
  CLEAR W_FCAT_SPFLI.

  W_FCAT_SPFLI-COL_POS       = '3'.
  W_FCAT_SPFLI-FIELDNAME     = 'COUNTRYFR'.
  W_FCAT_SPFLI-REF_TABNAME   = 'SPFLI'.
  W_FCAT_SPFLI-REF_FIELDNAME = 'COUNTRYFR'.
  APPEND W_FCAT_SPFLI TO T_FCAT_SPFLI.
  CLEAR W_FCAT_SPFLI.

  W_FCAT_SPFLI-COL_POS       = '4'.
  W_FCAT_SPFLI-FIELDNAME     = 'CITYFROM'.
  W_FCAT_SPFLI-REF_TABNAME   = 'SPFLI'.
  W_FCAT_SPFLI-REF_FIELDNAME = 'CITYFROM'.
  APPEND W_FCAT_SPFLI TO T_FCAT_SPFLI.
  CLEAR W_FCAT_SPFLI.

ENDFORM.

FORM CREATE_FCAT_SFLIGHT.
***build fcat for SFLIGHT
  W_FCAT_SFLIGHT-COL_POS       = '1'.
  W_FCAT_SFLIGHT-FIELDNAME     = 'CARRID'.
  W_FCAT_SFLIGHT-REF_TABNAME   = 'SFLIGHT'.
  W_FCAT_SFLIGHT-FIELDNAME = 'CARRID'.
  APPEND W_FCAT_SFLIGHT TO T_FCAT_SFLIGHT.
  CLEAR W_FCAT_SFLIGHT.

  W_FCAT_SFLIGHT-COL_POS       = '2'.
  W_FCAT_SFLIGHT-FIELDNAME     = 'CONNID'.
  W_FCAT_SFLIGHT-REF_TABNAME   = 'SFLIGHT'.
  W_FCAT_SFLIGHT-REF_FIELDNAME = 'CONNID'.
  APPEND W_FCAT_SFLIGHT TO T_FCAT_SFLIGHT.
  CLEAR W_FCAT_SFLIGHT.

  W_FCAT_SFLIGHT-COL_POS       = '3'.
  W_FCAT_SFLIGHT-FIELDNAME     = 'FLDATE'.
  W_FCAT_SFLIGHT-REF_TABNAME   = 'SFLIGHT'.
  W_FCAT_SFLIGHT-REF_FIELDNAME = 'FLDATE'.
  APPEND W_FCAT_SFLIGHT TO T_FCAT_SFLIGHT.
  CLEAR W_FCAT_SFLIGHT.

  W_FCAT_SFLIGHT-COL_POS       = '4'.
  W_FCAT_SFLIGHT-FIELDNAME     = 'PRICE'.
  W_FCAT_SFLIGHT-REF_TABNAME   = 'SFLIGHT'.
  W_FCAT_SFLIGHT-REF_FIELDNAME = 'PRICE'.
  APPEND W_FCAT_SFLIGHT TO T_FCAT_SFLIGHT.
  CLEAR W_FCAT_SFLIGHT.
ENDFORM.

FORM BLOCK_LIST_INIT.
  CALL FUNCTION 'REUSE_ALV_BLOCK_LIST_INIT' "initialize Block List ALV
    EXPORTING
      I_CALLBACK_PROGRAM = SY-REPID.
ENDFORM.

FORM BLOCK_LIST_APPEND_SPFLI.
  CALL FUNCTION 'REUSE_ALV_BLOCK_LIST_APPEND' "append ALV lists
    EXPORTING
      IS_LAYOUT   = S_LAYOUT "set layout
      IT_FIELDCAT = T_FCAT_SPFLI "set field catalog
      I_TABNAME   = 'IT_SPFLI' "table
      IT_EVENTS   = S_EVENTS "events
    TABLES
      T_OUTTAB    = IT_SPFLI. "out put table

  IF SY-SUBRC <> 0.
* Implement suitable error handling here
  ENDIF.
ENDFORM.

FORM BLOCK_LIST_APPEND_SFLIGHT.
  CALL FUNCTION 'REUSE_ALV_BLOCK_LIST_APPEND' "append ALV lists
    EXPORTING
      IS_LAYOUT   = S_LAYOUT "set layout
      IT_FIELDCAT = T_FCAT_SFLIGHT "set field catalog
      I_TABNAME   = 'IT_SFLIGHT' "table
      IT_EVENTS   = S_EVENTS "events
    TABLES
      T_OUTTAB    = IT_SFLIGHT. "out put table

  IF SY-SUBRC <> 0.
* Implement suitable error handling here
  ENDIF.

ENDFORM.